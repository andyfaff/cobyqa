# .circleci/config.yml
# CircleCI configuration file
# See https://circleci.com/docs/2.0/configuration-reference/ for details

version: 2.1

orbs:
  codecov: codecov/codecov@3.2.0

jobs:
  generate-report:
    parameters:
      python:
        type: string
    docker:
      - image: cimg/python:<< parameters.python >>
    steps:
      - run: bash build_tools/circle/build_coverage.sh

workflows:
  version: 2
  upload-to-codecov:
    jobs:
      - checkout
      - generate-report:
          matrix:
            parameters:
              python: ['3.6', '3.7', '3.8', '3.9']
          filters:
            branches:
              only:
                - main
      - codecov/upload:
          filters:
            branches:
              only:
                - main
